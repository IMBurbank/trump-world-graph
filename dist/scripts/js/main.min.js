"use strict";var width=900,height=width/1.6,fillColors={Person:"rgba(44, 143, 204, 0.95)",Organization:"rgba(244, 89, 58, 0.95)"},dataPath="assets/datasets/trumpworld.csv",simulation=d3.forceSimulation().force("link",d3.forceLink().id(function(t){return t.id}).distance([50])).force("charge",d3.forceManyBody().strength(function(t){return[-4*Math.pow(t.links,.5)-20]}).distanceMin([.001]).distanceMax([width/2])).force("center",d3.forceCenter(width/2,height/2)),svg=d3.select("#graph").append("svg").attrs({height:height,width:width,class:"chart-palette"}),detailDiv=d3.select("#graph").append("div").attrs({id:"details",class:"details"}).style("opacity",0),tooltipDiv=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),updateDetailDiv=function(t){detailDiv.transition().duration(200).styles({opacity:.9,"z-index":5}),detailDiv.styles({"min-width":width/3+"px",height:height/3+"px"}).html("<strong>"+t.id+"</strong><br/>\n      <br/>\n      Type: "+t.group+"<br/>\n      Links: "+t.links+'<br/>\n      <div class="table-container">\n        <table class="link-table">\n          <caption><h3>Trump World Connections</h3></caption>\n          <col/><col/><col/><col/>\n          <thead>\n            <tr>\n              <th class="link-table-index">#</th>\n              <th class="link-table-name">Name</th>\n              <th class="link-table-type">Type</th>\n              <th class="link-table-details">Details</th>\n              <th class="link-table-scroll"></th>\n            </tr>\n          </thead>\n          <tbody>\n            '+t.connections.reduce(function(t,n,e){return t+'<tr>\n                <td class="link-table-index">'+(e+1)+'</td>\n                <td class="link-table-name">'+n.name+'</td>\n                <td class="link-table-type">'+n.type+'</td>\n                <td class="link-table-details">\n                  <a href='+n.source+' target="_blank">'+n.connection+"</a>\n                </td>\n              </tr>"},"")+"\n          </tbody>\n        </table>\n      </div>")},dragStarted=function(t){d3.event.active||simulation.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y},dragged=function(t){t.fx=Math.max(t.radius,Math.min(width-t.radius,d3.event.x)),t.fy=Math.max(t.radius,Math.min(height-t.radius,d3.event.y))},dragEnded=function(t){d3.event.active||simulation.alphaTarget(0),t.fx=null,t.fy=null,updateDetailDiv(t)},treatData=function(t){var n=["A","B"],e={},i={},a=[],r=[],o=[],s=new Set,c="";t.forEach(function(t){n.forEach(function(i,a){c=t["Entity "+i],e[c]?(e[c].links++,e[c].connections.push({name:t["Entity "+n[1-a]],type:t["Entity "+n[1-a]+" Type"],connection:t.Connection,source:t["Source(s)"]})):e[c]={id:c,links:1,group:t["Entity "+i+" Type"],connections:[{name:t["Entity "+n[1-a]],type:t["Entity "+n[1-a]+" Type"],connection:t.Connection,source:t["Source(s)"]}]}}),r.push({source:t["Entity A"],target:t["Entity B"]})});for(var l in e)i=e[l],i.links<=3?o.push(l):(i.radius=Math.pow(i.links,9/16)+3,a.push(i));return r=r.filter(function(t){return!o.includes(t.source)&&!o.includes(t.target)}),r.forEach(function(t){s.add(t.source),s.add(t.target)}),a=a.filter(function(t){return s.has(t.id)}).sort(function(t,n){return n.links-t.links}),a.forEach(function(t){return t.connections.sort(function(t,n){return t.name<=n.name?-1:1})}),{nodes:a,links:r}},forceDirectedGraph=function(t,n){var e=svg.append("g").attr("class","link").selectAll("line").data(n).enter().append("line"),i=svg.append("g").attr("class","node").selectAll("circle").data(t).enter().append("circle").attrs({r:function(t){return t.radius},fill:function(t){return fillColors[t.group]}}).on("mouseover",function(t){tooltipDiv.transition().duration(200).style("opacity",.9),tooltipDiv.html(t.id+"<br/>\n          Type: "+t.group+"<br/>\n          Links: "+t.links).styles({left:d3.event.pageX+"px",top:d3.event.pageY+12+"px"})}).on("mouseout",function(t){tooltipDiv.transition().duration(500).style("opacity",0)}).call(d3.drag().on("start",dragStarted).on("drag",dragged).on("end",dragEnded)),a=function(){e.attrs({x1:function(t){return t.source.x},y1:function(t){return t.source.y},x2:function(t){return t.target.x},y2:function(t){return t.target.y}}),i.attrs({cx:function(t){return t.x=Math.max(t.radius,Math.min(width-t.radius,t.x))},cy:function(t){return t.y=Math.max(t.radius,Math.min(height-t.radius,t.y))}})};d3.select("body").on("click",function(t){"circle"!==d3.event.target.localName&&d3.event.path.every(function(t){return"details"!==t.id})&&detailDiv.transition().duration(333).styles({opacity:0,"z-index":-1})}),simulation.nodes(t).on("tick",a),simulation.force("link").links(n)};d3.csv(dataPath,function(t,n){if(t)throw t;var e=treatData(n),i=e.nodes,a=e.links;forceDirectedGraph(i,a)});